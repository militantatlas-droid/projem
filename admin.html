<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MÄ°LÄ°TAN ATLASI | YAZAR VE EDÄ°TÃ–R PANELÄ°</title>
  <style>
    :root { --accent: #4ade80; --bg: #0f0f0f; --panel: #1a1a1a; --border: #333; }
    body { font-family: sans-serif; background: var(--bg); color: #eee; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
    
    /* ÃœST BAR */
    #header { height: 60px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; }
    .logo { color: var(--accent); font-weight: bold; font-size: 20px; letter-spacing: 1px; }

    #main { display: flex; flex: 1; position: relative; overflow: hidden; }

    /* HARÄ°TA ALANI */
    #map-container { flex: 1; background: #050505; position: relative; cursor: grab; }
    svg { width: 100%; height: 100%; }
    path { fill: #252525; stroke: #000; stroke-width: 0.8; transition: 0.2s; cursor: pointer; }
    path:hover { fill: #333; stroke: var(--accent); }
    path.selected { fill: #1a3a2a; stroke: var(--accent); stroke-width: 2; }

    /* BÄ°LGÄ° KUTUSU (Tooltip) */
    #tooltip {
      position: absolute; pointer-events: none; background: rgba(0,0,0,0.9);
      border: 1px solid var(--accent); padding: 10px; border-radius: 5px;
      font-size: 13px; display: none; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }

    /* SAÄž EDÄ°TÃ–R PANELÄ° */
    #editor-panel {
      width: 500px; background: var(--panel); border-left: 1px solid var(--border);
      display: flex; flex-direction: column; transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: absolute; right: 0; top: 0; bottom: 0; z-index: 200;
    }
    #editor-panel.open { transform: translateX(0); }

    .panel-header { padding: 20px; background: #222; border-bottom: 1px solid var(--border); }
    .panel-content { flex: 1; overflow-y: auto; padding: 20px; }

    /* SEKMELÄ° YAPI (YAZAR MODU) */
    .tabs { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    .tab-btn { 
      background: #252525; border: 1px solid var(--border); color: #888; 
      padding: 6px 12px; cursor: pointer; font-size: 11px; border-radius: 3px;
    }
    .tab-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* FORM ELEMANLARI */
    label { display: block; margin-top: 15px; color: var(--accent); font-size: 12px; font-weight: bold; text-transform: uppercase; }
    input, select, textarea {
      width: 100%; padding: 10px; margin-top: 5px; background: #0a0a0a; 
      border: 1px solid var(--border); color: #fff; border-radius: 4px; box-sizing: border-box;
    }
    textarea { height: 180px; line-height: 1.5; font-family: 'Courier New', monospace; }
    
    /* GRUP LÄ°STESÄ° (Ãœlke iÃ§i) */
    .group-selector { background: #222; padding: 10px; border-radius: 5px; margin-bottom: 20px; }
    .group-pill { 
      display: inline-block; padding: 5px 10px; background: #333; margin: 3px; 
      border-radius: 3px; cursor: pointer; font-size: 12px; 
    }
    .group-pill.active { background: var(--accent); color: #000; }

    /* BUTONLAR */
    .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
    .btn-save { background: var(--accent); color: #000; }
    .btn-add { background: #2563eb; color: #fff; width: 100%; margin-top: 10px; }
    .btn-delete { background: #dc2626; color: #fff; margin-top: 30px; font-size: 11px; opacity: 0.6; }
    .btn-delete:hover { opacity: 1; }

    /* DOSYA YÃœKLEME EKRANI */
    #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; align-items: center; justify-content: center; text-align: center; }
  </style>
</head>
<body>

<div id="overlay">
  <div>
    <h1 style="color:var(--accent)">MÄ°LÄ°TAN ATLASI EDÄ°TÃ–R V2</h1>
    <p>DÃ¼zenlemek istediÄŸiniz <b>trdata.json</b> dosyasÄ±nÄ± seÃ§in.</p>
    <input type="file" id="json-input" accept=".json" style="display:none">
    <button class="btn btn-save" onclick="document.getElementById('json-input').click()">DOSYA YÃœKLE</button>
  </div>
</div>

<div id="header">
  <div class="logo">MÄ°LÄ°TAN ATLASI | <span id="current-mode">EDÄ°TÃ–R</span></div>
  <button class="btn btn-save" onclick="downloadJSON()">ðŸ’¾ JSON OLARAK KAYDET</button>
</div>

<div id="main">
  <div id="map-container">
    <div id="tooltip"></div>
    <div id="map-wrapper">
       <svg id="main-svg" viewBox="0 0 1000 500">
         <g id="map-layer"></g>
       </svg>
    </div>
  </div>

  <div id="editor-panel">
    <div class="panel-header">
      <h2 id="edit-country-name" style="margin:0; color:var(--accent);">Ãœlke SeÃ§ilmedi</h2>
      <div id="group-list-area" class="group-selector">
        </div>
      <button class="btn btn-add" onclick="addNewGroup()">+ Yeni Ã–rgÃ¼t Ekle</button>
    </div>

    <div class="panel-content" id="editor-fields" style="display:none;">
      <label>Ã–rgÃ¼t AdÄ±</label>
      <input type="text" id="f-name" oninput="syncData()">

      <label>Kategori</label>
      <select id="f-cat" onchange="syncData()">
        <option value="TerÃ¶r Ã–rgÃ¼tÃ¼">TerÃ¶r Ã–rgÃ¼tÃ¼</option>
        <option value="Milis GÃ¼cÃ¼">Milis GÃ¼cÃ¼</option>
        <option value="Ä°syancÄ± Grup">Ä°syancÄ± Grup</option>
        <option value="Paramiliter">Paramiliter</option>
      </select>

      <div class="tabs" style="margin-top:20px;">
        <button class="tab-btn active" onclick="showTab(0)">OluÅŸum</button>
        <button class="tab-btn" onclick="showTab(1)">Hedef</button>
        <button class="tab-btn" onclick="showTab(2)">YÃ¶netim</button>
        <button class="tab-btn" onclick="showTab(3)">Taktik</button>
        <button class="tab-btn" onclick="showTab(4)">Eylemler</button>
        <button class="tab-btn" onclick="showTab(5)">Kaynak</button>
        <button class="tab-btn" onclick="showTab(6)">Ä°liÅŸkiler</button>
        <button class="tab-btn" onclick="showTab(7)">DiÄŸer</button>
        <button class="tab-btn" onclick="showTab(8)">KaynakÃ§a</button>
      </div>

      <div id="tab-container">
        <div class="tab-content active"><label>OluÅŸumu ve GeliÅŸimi</label><textarea id="f-olusum" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>AmaÃ§ ve Nihai Hedef</label><textarea id="f-hedef" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>YÃ¶netim ve YapÄ±lanma</label><textarea id="f-yonetim" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>KullandÄ±klarÄ± Eylem Taktikleri</label><textarea id="f-taktik" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>Eylemler</label><textarea id="f-eylem" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>Kaynak Temini</label><textarea id="f-kaynak" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>DiÄŸer Gruplarla Ä°liÅŸkiler</label><textarea id="f-iliski" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>DiÄŸer Bilgiler</label><textarea id="f-diger" oninput="syncData()"></textarea></div>
        <div class="tab-content"><label>KaynakÃ§a (Linkler vb.)</label><textarea id="f-ref" oninput="syncData()" placeholder="Ã–rn: [1] Haber Linki..."></textarea></div>
      </div>

      <button class="btn btn-delete" onclick="deleteCurrentGroup()">BU Ã–RGÃœTÃœ SÄ°L</button>
    </div>
  </div>
</div>

<script>
/** * NOT: Harita path verilerini (SVG) sistemin Ã§alÄ±ÅŸmasÄ± iÃ§in 
 * index(22).html dosyasÄ±ndaki <path> etiketlerini alÄ±p buraya entegre ediyorum.
 */
const COUNTRY_PATHS = {
    "TR": "M 650,250 L 670,250 L 660,270 Z", // Ã–rnek path, JS tÃ¼mÃ¼nÃ¼ yÃ¼kleyecek
    "AO": "m 495.3,598.6 ...", // GerÃ§ek pathler aÅŸaÄŸÄ±da yÃ¼klenecek
};

let mainData = {};
let selectedCountryId = null;
let selectedGroupIdx = null;

// Dosya YÃ¼kleme Ä°ÅŸlemi
document.getElementById('json-input').onchange = function(e) {
  const reader = new FileReader();
  reader.onload = function() {
    mainData = JSON.parse(reader.result);
    document.getElementById('overlay').style.display = 'none';
    initMap();
  };
  reader.readAsText(e.target.files[0]);
};

// HaritayÄ± BaÅŸlat (Daha Ã¶nce gÃ¶nderdiÄŸin tÃ¼m pathleri buraya dahil edebilirsin)
// Ben burada temel mantÄ±ÄŸÄ± kuruyorum
function initMap() {
  const layer = document.getElementById('map-layer');
  // Ã–nemli: Sen buraya index.html'deki tÃ¼m <path> etiketlerini string olarak yapÄ±ÅŸtÄ±rabilirsin.
  // Ã–rnek olarak birkaÃ§ tane ekliyorum:
  const svgContent = `
    <path id="AO" d="m 495.3,598.6 -36,-0.2 -4.3,1.7 -3.5,-0.3 -5.1,1.9 -1.1,2.7 6,8.7 2.4,9.3 3.6,13.4 -3.8,5.5 -0.6,2.8 2.9,8.3 3.1,8.4 3.6,5 0.6,7.8 -1.4,10.3 -4,6.1 -7.1,9.1 -2.9,5.6 -4.1,12.5 -0.8,5.9 -4.3,12.7 -1.9,12.2 1,8.7 5.9,-2.7 7.2,-2.3 7.8,0.4 7.1,6.3 1.9,-1 48.8,-0.6 8.2,6.6 29.1,2 22.4,-5.7 -7.6,-8.6 -7.8,-11.3 1.6,-44 25.3,0.1 -1,-4.7 2,-5.2 -2,-6.5 1.5,-6.7 -1.2,-4.3 -5.5,-0.8 -7.6,2 -5.3,-0.3 -3,1.3 0.9,-16.5 -3.9,-5.1 -0.8,-8.5 1.9,-8.4 -2.4,-5.3 -0.1,-8.7 -14.8,0.1 1.1,-5 -6.2,0.1 -0.7,2.4 -7.6,0.5 -3.1,8.1 -1.9,3.4 -6.7,-1.9 -4,1.9 -8.1,1.1 -4.6,-7.2 -2.7,-4.5 -3.5,-8.3 -2.9,-10.3 z" />
    <path id="TR" d="M 618.3,270 L 680,270 L 680,300 L 610,300 Z" />
    <path id="NG" d="m 468.2,344.6 -2.2,0.3 -8.4,-15.1 -2.9,-0.6 -9.4,7.7 -9.4,-4 -6.5,-0.8 -3.5,1.9 -7.1,-0.4 -7.1,5.9 -6.2,0.3 -14.7,-7.1 -5.8,3.4 -6.1,-0.2 -4.6,-5.3 -12.2,-5.1 -13,1.6 -3.2,3 -1.6,8 -3.5,5.5 -0.8,12.4 -0.5,4.6 2.8,8.2 -2.4,5.6 1.3,3.7 -5.9,8.5 -3.7,4.3 -2.3,8.7 0.3,8.8 -0.6,22.3 10.7,0 9.2,-0.1 8.6,9.1 4.1,10 6.5,8.6 9.8,0.3 4.7,-3.1 4.6,0.8 12.7,-5 3.1,-9.8 5.7,-13.4 3.6,-0.1 7.2,-8.1 4.6,-0.2 6.9,5.7 8.3,-4.7 1.1,-5.7 2.7,-5.6 1.9,-7 6.4,-5.7 2.4,-9.7 2.6,-3.1 1.6,-7.2 3.1,-8.8 10.2,-10.7 0.5,-4.6 1.3,-2.5 -4.9,-5.5 z" />
  `;
  // NOT: Buraya tÃ¼m pathleri ekleyebilirsin.
  layer.innerHTML = svgContent;

  const paths = layer.querySelectorAll('path');
  paths.forEach(p => {
    // Tooltip - Ãœzerine gelince
    p.onmouseenter = (e) => showTooltip(e, p.id);
    p.onmousemove = (e) => moveTooltip(e);
    p.onmouseleave = () => hideTooltip();
    
    // TÄ±klayÄ±nca - SeÃ§me ve Paneli AÃ§ma
    p.onclick = () => selectCountry(p.id);
  });
}

// TOOLTIP FONKSÄ°YONLARI
function showTooltip(e, id) {
  const tip = document.getElementById('tooltip');
  const country = mainData[id];
  const count = (country && country.groups) ? country.groups.length : 0;
  const names = (country && country.groups) ? country.groups.map(g => g.name_tr).join(", ") : "Ã–rgÃ¼t yok";
  
  tip.innerHTML = `<b>${id}</b><br>Ã–rgÃ¼t SayÄ±sÄ±: ${count}<br><small>${names}</small>`;
  tip.style.display = 'block';
}
function moveTooltip(e) {
  const tip = document.getElementById('tooltip');
  tip.style.left = (e.pageX + 15) + 'px';
  tip.style.top = (e.pageY + 15) + 'px';
}
function hideTooltip() {
  document.getElementById('tooltip').style.display = 'none';
}

// ÃœLKE SEÃ‡Ä°MÄ°
function selectCountry(id) {
  selectedCountryId = id;
  selectedGroupIdx = null;
  
  // Haritada gÃ¶rsel seÃ§imi
  document.querySelectorAll('path').forEach(p => p.classList.remove('selected'));
  document.getElementById(id).classList.add('selected');

  // Paneli AÃ§
  document.getElementById('edit-country-name').innerText = id + " DÃ¼zenleniyor";
  document.getElementById('editor-panel').classList.add('open');
  document.getElementById('editor-fields').style.display = 'none';
  
  renderGroupPills();
}

// ÃœLKE Ä°Ã‡Ä°NDEKÄ° Ã–RGÃœTLERÄ° LÄ°STELE
function renderGroupPills() {
  const area = document.getElementById('group-list-area');
  area.innerHTML = "";
  
  if(mainData[selectedCountryId] && mainData[selectedCountryId].groups) {
    mainData[selectedCountryId].groups.forEach((g, idx) => {
      const pill = document.createElement('div');
      pill.className = 'group-pill' + (selectedGroupIdx === idx ? ' active' : '');
      pill.innerText = g.name_tr || "Ä°simsiz";
      pill.onclick = () => loadGroupData(idx);
      area.appendChild(pill);
    });
  }
}

// Ã–RGÃœT VERÄ°SÄ°NÄ° FORMA YÃœKLE
function loadGroupData(idx) {
  selectedGroupIdx = idx;
  renderGroupPills();
  
  const g = mainData[selectedCountryId].groups[idx];
  const d = g.details || {};

  document.getElementById('editor-fields').style.display = 'block';
  document.getElementById('f-name').value = g.name_tr || "";
  document.getElementById('f-cat').value = g.kategori || "TerÃ¶r Ã–rgÃ¼tÃ¼";
  
  // Sekme iÃ§erikleri
  document.getElementById('f-olusum').value = d.olusum_sureci || "";
  document.getElementById('f-hedef').value = d.nihai_hedef || "";
  document.getElementById('f-yonetim').value = d.yonetim_yapisi || "";
  document.getElementById('f-taktik').value = d.eylem_metotlari || "";
  document.getElementById('f-eylem').value = d.eylemler || "";
  document.getElementById('f-kaynak').value = d.finansman_kaynaklari || "";
  document.getElementById('f-iliski').value = d.grup_iliskileri || "";
  document.getElementById('f-diger').value = d.diger_bilgiler || "";
  document.getElementById('f-ref').value = d.kaynakca || "";
}

// FORMDAKÄ° DEÄžÄ°ÅžÄ°KLÄ°KLERÄ° JSON'A AKTAR
function syncData() {
  if(selectedCountryId === null || selectedGroupIdx === null) return;
  
  let g = mainData[selectedCountryId].groups[selectedGroupIdx];
  g.name_tr = document.getElementById('f-name').value;
  g.kategori = document.getElementById('f-cat').value;
  
  if(!g.details) g.details = {};
  g.details.olusum_sureci = document.getElementById('f-olusum').value;
  g.details.nihai_hedef = document.getElementById('f-hedef').value;
  g.details.yonetim_yapisi = document.getElementById('f-yonetim').value;
  g.details.eylem_metotlari = document.getElementById('f-taktik').value;
  g.details.eylemler = document.getElementById('f-eylem').value;
  g.details.finansman_kaynaklari = document.getElementById('f-kaynak').value;
  g.details.grup_iliskileri = document.getElementById('f-iliski').value;
  g.details.diger_bilgiler = document.getElementById('f-diger').value;
  g.details.kaynakca = document.getElementById('f-ref').value;

  // Listeyi gÃ¼ncelle (Ä°sim deÄŸiÅŸmiÅŸ olabilir)
  renderGroupPills();
}

// YENÄ° Ã–RGÃœT EKLE
function addNewGroup() {
  if(!mainData[selectedCountryId]) {
    mainData[selectedCountryId] = { name_tr: selectedCountryId, groups: [] };
  }
  mainData[selectedCountryId].groups.push({
    name_tr: "Yeni Ã–rgÃ¼t",
    kategori: "TerÃ¶r Ã–rgÃ¼tÃ¼",
    details: {}
  });
  loadGroupData(mainData[selectedCountryId].groups.length - 1);
}

// Ã–RGÃœTÃœ SÄ°L
function deleteCurrentGroup() {
  if(confirm("Bu Ã¶rgÃ¼tÃ¼ tamamen silmek istediÄŸinize emin misiniz?")) {
    mainData[selectedCountryId].groups.splice(selectedGroupIdx, 1);
    selectedGroupIdx = null;
    document.getElementById('editor-fields').style.display = 'none';
    renderGroupPills();
  }
}

// SEKME DEÄžÄ°ÅžTÄ°RME
function showTab(idx) {
  document.querySelectorAll('.tab-btn').forEach((b, i) => {
    b.classList.toggle('active', i === idx);
  });
  document.querySelectorAll('.tab-content').forEach((c, i) => {
    c.classList.toggle('active', i === idx);
  });
}

// JSON Ä°NDÄ°R
function downloadJSON() {
  const dataStr = JSON.stringify(mainData, null, 2);
  const blob = new Blob([dataStr], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = "trdata.json";
  a.click();
}
</script>

</body>
</html>
