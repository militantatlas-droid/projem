<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MÄ°LÄ°TAN ATLASI | YAZAR PANELÄ° PRO</title>
  <style>
    :root { 
      --accent: #3b82f6; 
      --bg-dark: #121212; /* AÃ§Ä±k Siyah / Antrasit */
      --panel-bg: #ffffff; 
      --map-land: #ffffff; /* Harita Beyaz */
      --map-stroke: #cbd5e1;
      --text-main: #1e293b;
    }

    body { 
      font-family: 'Inter', system-ui, sans-serif; 
      background: var(--bg-dark); 
      color: #fff; 
      margin: 0; 
      overflow: hidden; 
      height: 100vh; 
    }

    /* GÄ°RÄ°Åž EKRANI */
    #login-screen {
      position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 10000;
    }
    .login-box {
      background: #1e1e1e; padding: 40px; border-radius: 16px; border: 1px solid #333; width: 320px; text-align: center;
    }
    .login-box input { 
      width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; 
    }
    .btn-login { 
      background: var(--accent); color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px;
    }

    /* ANA YAPI */
    #app { display: none; flex-direction: column; height: 100vh; }
    #header { 
      height: 60px; background: #1a1a1a; border-bottom: 1px solid #333; 
      display: flex; align-items: center; justify-content: space-between; padding: 0 20px; 
    }

    #main { display: flex; flex: 1; position: relative; overflow: hidden; background: var(--bg-dark); }

    /* HARÄ°TA KONTEYNER */
    #map-container { 
      flex: 1; position: relative; display: flex; align-items: center; justify-content: center; padding: 20px;
    }
    #map-wrapper { 
      width: 100%; height: 100%; max-width: 1200px; display: flex; align-items: center; justify-content: center;
    }
    svg { width: 100%; height: auto; max-height: 90vh; }
    path { 
      fill: var(--map-land); stroke: var(--map-stroke); stroke-width: 0.4; 
      transition: all 0.2s ease; cursor: pointer; 
    }
    path:hover { fill: #f8fafc; stroke: var(--accent); stroke-width: 1; }
    path.selected { fill: #e0f2fe; stroke: var(--accent); stroke-width: 1.5; }

    /* EDÄ°TÃ–R PANELÄ° (SIDEBAR) */
    #editor-panel {
      width: 500px; background: var(--panel-bg); color: var(--text-main);
      position: absolute; right: 0; top: 0; bottom: 0; z-index: 500;
      transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: -10px 0 30px rgba(0,0,0,0.5); display: flex; flex-direction: column;
    }
    #editor-panel.active { transform: translateX(0); }

    .panel-content { flex: 1; overflow-y: auto; padding: 25px; }

    /* TOOLTIP */
    #tooltip {
      position: absolute; pointer-events: none; background: #fff; color: #000;
      padding: 8px 12px; border-radius: 6px; font-size: 12px; display: none;
      z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 1px solid var(--accent);
    }

    /* YAZAR ARAÃ‡LARI */
    .tabs { display: flex; flex-wrap: wrap; gap: 4px; margin: 15px 0; }
    .tab-btn { 
      padding: 6px 10px; font-size: 11px; background: #f1f5f9; border: 1px solid #e2e8f0; 
      border-radius: 4px; cursor: pointer; font-weight: 600; 
    }
    .tab-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
    
    .editor-toolbar { background: #f8fafc; padding: 8px; border: 1px solid #e2e8f0; border-bottom: none; border-radius: 8px 8px 0 0; display: flex; gap: 8px; }
    .rich-editor { 
      min-height: 250px; background: #fff; border: 1px solid #e2e8f0; border-radius: 0 0 8px 8px; padding: 15px; outline: none; line-height: 1.6;
    }
    
    .pill { display: inline-block; padding: 5px 12px; background: #f1f5f9; margin: 3px; border-radius: 20px; font-size: 12px; cursor: pointer; border: 1px solid #cbd5e1; }
    .pill.active { background: var(--accent); color: #fff; }

    .btn { padding: 10px 16px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
    .btn-save { background: var(--accent); color: #fff; }
    .btn-add { background: #10b981; color: #fff; width: 100%; margin-bottom: 15px; }
  </style>
</head>
<body>

<div id="login-screen">
  <div class="login-box">
    <h2>MÄ°LÄ°TAN ATLASI</h2>
    <p style="color: #888; font-size: 13px;">Sistem EriÅŸim Kilidi</p>
    <input type="text" id="user" placeholder="KullanÄ±cÄ± AdÄ±">
    <input type="password" id="pass" placeholder="Åžifre">
    <button class="btn-login" onclick="login()">GÄ°RÄ°Åž YAP</button>
  </div>
</div>

<div id="app">
  <div id="header">
    <div style="font-weight: 800; letter-spacing: 1px;">MÄ°LÄ°TAN ATLASI <span style="color:var(--accent)">EDITOR</span></div>
    <div>
      <input type="file" id="load-file" style="display:none" onchange="handleFile(this)">
      <button class="btn" style="background:#444; color:#fff; margin-right:10px" onclick="document.getElementById('load-file').click()">JSON YÃœKLE</button>
      <button class="btn btn-save" onclick="saveJSON()">JSON Ä°NDÄ°R (KAYDET)</button>
    </div>
  </div>

  <div id="main">
    <div id="map-container" onclick="closePanel()">
      <div id="tooltip"></div>
      <div id="map-wrapper">
        <svg id="svg-map" viewBox="0 0 1010 666" preserveAspectRatio="xMidYMid meet">
          <g id="paths-container"></g>
        </svg>
      </div>
    </div>

    <div id="editor-panel" onclick="event.stopPropagation()">
      <div class="panel-content">
        <h2 id="country-title" style="margin-top:0">Ãœlke SeÃ§ilmedi</h2>
        <div id="group-pills"></div>
        <button class="btn btn-add" onclick="addGroup()">+ Yeni Ã–rgÃ¼t Ekle</button>

        <div id="edit-form" style="display:none; border-top: 1px solid #eee; padding-top: 20px;">
          <label style="font-size:12px; font-weight:bold; color:#64748b">Ã–RGÃœT ADI</label>
          <input type="text" id="org-name" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ddd; border-radius:6px;" oninput="sync()">
          
          <label style="font-size:12px; font-weight:bold; color:#64748b">KATEGORÄ°</label>
          <input type="text" id="org-cat" style="width:100%; padding:10px; margin:8px 0; border:1px solid #ddd; border-radius:6px;" oninput="sync()">

          <div class="tabs" id="tab-bar"></div>

          <div class="editor-toolbar">
            <button onclick="cmd('bold')"><b>B</b></button>
            <button onclick="cmd('italic')"><i>I</i></button>
            <button onclick="cmd('createLink', prompt('Link URL:'))">ðŸ”—</button>
            <button onclick="cmd('insertUnorderedList')">â€¢ Liste</button>
          </div>
          <div id="editor" class="rich-editor" contenteditable="true" oninput="sync()"></div>
          
          <button class="btn" style="background:#fee2e2; color:#ef4444; width:100%; margin-top:20px" onclick="deleteOrg()">Ã–rgÃ¼tÃ¼ Sil</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const AUTH = { u: "admin", p: "militan123" };
let data = {};
let curC = null, curG = null, curT = 0;
const tabs = ["OluÅŸum ve GeliÅŸimi", "AmaÃ§ ve Nihai Hedef", "YÃ¶netim ve YapÄ±lanma", "Eylem Taktikleri", "Eylemler", "Kaynak Temini", "DiÄŸer Gruplarla Ä°liÅŸkiler", "DiÄŸer Bilgiler", "KaynakÃ§a"];
const keys = ["olusum", "amach", "yonetim", "taktik", "eylem", "kaynak", "iliski", "diger", "ref"];

function login() {
  if(document.getElementById('user').value === AUTH.u && document.getElementById('pass').value === AUTH.p) {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'flex';
    init();
  } else { alert("HatalÄ± GiriÅŸ!"); }
}

function init() {
  const container = document.getElementById('paths-container');
  // Buraya elindeki tÃ¼m <path> verilerini ekle. Ã–rnek TR:
  container.innerHTML = `<path id="TR" d="M 610,210 L 690,210 L 690,250 L 610,250 Z" />`; 

  document.querySelectorAll('path').forEach(p => {
    p.addEventListener('mouseenter', e => showTip(e, p.id));
    p.addEventListener('mousemove', moveTip);
    p.addEventListener('mouseleave', hideTip);
    p.addEventListener('click', e => { e.stopPropagation(); openCountry(p.id); });
  });

  // ESC TuÅŸu KontrolÃ¼
  window.addEventListener('keydown', e => { if(e.key === "Escape") closePanel(); });

  // Tab butonlarÄ±nÄ± oluÅŸtur
  const bar = document.getElementById('tab-bar');
  tabs.forEach((t, i) => {
    const btn = document.createElement('button');
    btn.className = 'tab-btn' + (i===0?' active':'');
    btn.innerText = t;
    btn.onclick = () => { curT = i; updateTabs(); };
    bar.appendChild(btn);
  });
}

function openCountry(id) {
  curC = id; curG = null;
  document.querySelectorAll('path').forEach(p => p.classList.remove('selected'));
  document.getElementById(id).classList.add('selected');
  document.getElementById('country-title').innerText = id;
  document.getElementById('editor-panel').classList.add('active');
  document.getElementById('edit-form').style.display = 'none';
  renderPills();
}

function closePanel() {
  document.getElementById('editor-panel').classList.remove('active');
  document.querySelectorAll('path').forEach(p => p.classList.remove('selected'));
  curC = null;
}

function renderPills() {
  const box = document.getElementById('group-pills');
  box.innerHTML = "";
  if(!data[curC]) data[curC] = { groups: [] };
  data[curC].groups.forEach((g, i) => {
    const p = document.createElement('div');
    p.className = 'pill' + (curG === i ? ' active' : '');
    p.innerText = g.name_tr || "Ä°simsiz";
    p.onclick = () => { curG = i; loadGroup(); };
    box.appendChild(p);
  });
}

function loadGroup() {
  const g = data[curC].groups[curG];
  document.getElementById('edit-form').style.display = 'block';
  document.getElementById('org-name').value = g.name_tr || "";
  document.getElementById('org-cat').value = g.kategori || "";
  updateTabs();
  renderPills();
}

function updateTabs() {
  document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i === curT));
  const g = data[curC].groups[curG];
  if(!g.details) g.details = {};
  document.getElementById('editor').innerHTML = g.details[keys[curT]] || "";
}

function sync() {
  const g = data[curC].groups[curG];
  g.name_tr = document.getElementById('org-name').value;
  g.kategori = document.getElementById('org-cat').value;
  if(!g.details) g.details = {};
  g.details[keys[curT]] = document.getElementById('editor').innerHTML;
}

function addGroup() {
  data[curC].groups.push({ name_tr: "Yeni Ã–rgÃ¼t", details: {} });
  curG = data[curC].groups.length - 1;
  loadGroup();
}

function deleteOrg() {
  if(confirm("Silmek istediÄŸine emin misin?")) {
    data[curC].groups.splice(curG, 1);
    curG = null;
    document.getElementById('edit-form').style.display = 'none';
    renderPills();
  }
}

function cmd(c, v=null) { document.execCommand(c, false, v); }

function handleFile(input) {
  const reader = new FileReader();
  reader.onload = () => { data = JSON.parse(reader.result); alert("Veri YÃ¼klendi!"); };
  reader.readAsText(input.files[0]);
}

function saveJSON() {
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "militan_data_yeni.json";
  a.click();
}

function showTip(e, id) {
  const tip = document.getElementById('tooltip');
  const count = data[id]?.groups?.length || 0;
  tip.innerHTML = `<strong>${id}</strong><br>KayÄ±tlÄ± Ã–rgÃ¼t: ${count}`;
  tip.style.display = 'block';
}
function moveTip(e) {
  const tip = document.getElementById('tooltip');
  tip.style.left = (e.pageX + 15) + 'px';
  tip.style.top = (e.pageY + 15) + 'px';
}
function hideTip() { document.getElementById('tooltip').style.display = 'none'; }
</script>

</body>
</html>
