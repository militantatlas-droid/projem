<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MÄ°LÄ°TAN ATLASI | GELÄ°ÅžMÄ°Åž YAZAR PANELÄ°</title>
  <style>
    :root { --accent: #2563eb; --bg: #f8fafc; --panel: #ffffff; --border: #cbd5e1; --text: #1e293b; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
    
    /* ÃœST BAR */
    #header { height: 60px; background: #fff; border-bottom: 2px solid var(--accent); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .logo { color: var(--accent); font-weight: 800; font-size: 18px; text-transform: uppercase; }

    #main { display: flex; flex: 1; position: relative; overflow: hidden; }

    /* HARÄ°TA ALANI (BEYAZ TEMA) */
    #map-container { flex: 1; background: #ffffff; position: relative; display: flex; align-items: center; justify-content: center; }
    #map-wrapper { width: 95%; height: 95%; }
    svg { width: 100%; height: 100%; filter: drop-shadow(0 0 2px #ccc); }
    path { fill: #f1f5f9; stroke: #94a3b8; stroke-width: 0.5; transition: 0.2s; cursor: pointer; }
    path:hover { fill: #e2e8f0; stroke: var(--accent); }
    path.selected { fill: #dbeafe; stroke: var(--accent); stroke-width: 1.5; }

    /* TOOLTIP */
    #tooltip {
      position: absolute; pointer-events: none; background: rgba(255,255,255,0.95);
      border: 1px solid var(--accent); padding: 12px; border-radius: 8px;
      font-size: 13px; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.1); color: #000;
    }

    /* EDÄ°TÃ–R PANELÄ° */
    #editor-panel {
      width: 550px; background: var(--panel); border-left: 1px solid var(--border);
      display: flex; flex-direction: column; transform: translateX(100%);
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: absolute; right: 0; top: 0; bottom: 0; z-index: 200; box-shadow: -5px 0 15px rgba(0,0,0,0.05);
    }
    #editor-panel.open { transform: translateX(0); }

    .panel-header { padding: 20px; background: #f1f5f9; border-bottom: 1px solid var(--border); }
    .panel-content { flex: 1; overflow-y: auto; padding: 20px; }

    /* YAZAR MODU ARAÃ‡LARI (Rich Text) */
    .editor-toolbar { background: #eee; padding: 5px; border: 1px solid var(--border); border-bottom: none; display: flex; gap: 5px; border-radius: 4px 4px 0 0; }
    .toolbar-btn { padding: 4px 8px; cursor: pointer; background: #fff; border: 1px solid #ccc; border-radius: 3px; font-weight: bold; font-size: 12px; }
    .toolbar-btn:hover { background: var(--accent); color: white; }

    .rich-editor { 
      min-height: 250px; border: 1px solid var(--border); padding: 15px; 
      background: #fff; overflow-y: auto; border-radius: 0 0 4px 4px;
      line-height: 1.6; color: #333;
    }
    .rich-editor:focus { outline: 2px solid #3b82f633; }

    /* SEKMELER */
    .tabs { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 15px; }
    .tab-btn { 
      background: #e2e8f0; border: none; color: #475569; 
      padding: 8px 12px; cursor: pointer; font-size: 11px; font-weight: 600; border-radius: 4px;
    }
    .tab-btn.active { background: var(--accent); color: #fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* FORM */
    label { display: block; margin-top: 15px; color: #64748b; font-size: 11px; font-weight: 800; text-transform: uppercase; }
    input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; font-size: 14px; }
    
    .group-pill { display: inline-block; padding: 6px 14px; background: #f1f5f9; border: 1px solid var(--border); margin: 4px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: 500; }
    .group-pill.active { background: var(--accent); color: #fff; border-color: var(--accent); }

    .btn { padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn-save { background: var(--accent); color: #fff; }
    .btn-add { background: #059669; color: #fff; width: 100%; margin-top: 10px; }
    .btn-delete { background: #ef4444; color: #fff; margin-top: 40px; width: 100%; }

    #overlay { position: fixed; inset: 0; background: #fff; z-index: 1000; display: flex; align-items: center; justify-content: center; text-align: center; }
  </style>
</head>
<body>

<div id="overlay">
  <div>
    <h1 style="color:var(--accent); font-size: 40px;">MÄ°LÄ°TAN ATLASI</h1>
    <p style="color:#64748b">Yazar ve Veri DÃ¼zenleme Paneline HoÅŸ Geldiniz</p>
    <input type="file" id="json-input" accept=".json" style="display:none">
    <button class="btn btn-save" style="font-size:18px; padding: 15px 40px;" onclick="document.getElementById('json-input').click()">DOSYAYI YÃœKLE VE BAÅžLA</button>
  </div>
</div>

<div id="header">
  <div class="logo">MÄ°LÄ°TAN ATLASI // <span id="mode-text">EDÄ°TÃ–R</span></div>
  <button class="btn btn-save" onclick="downloadJSON()">ðŸ’¾ JSON OLARAK DIÅžA AKTAR</button>
</div>

<div id="main">
  <div id="map-container">
    <div id="tooltip"></div>
    <div id="map-wrapper">
       <svg id="main-svg" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet">
         <g id="map-layer"></g>
       </svg>
    </div>
  </div>

  <div id="editor-panel">
    <div class="panel-header">
      <h2 id="edit-country-name" style="margin:0 0 15px 0; color:var(--text);">Ãœlke SeÃ§in</h2>
      <div id="group-list-area"></div>
      <button class="btn btn-add" onclick="addNewGroup()">+ YENÄ° Ã–RGÃœT EKLE</button>
    </div>

    <div class="panel-content" id="editor-fields" style="display:none;">
      <label>Ã–rgÃ¼t Tam AdÄ±</label>
      <input type="text" id="f-name" oninput="syncData()">

      <label>Kategori (Kendi TanÄ±mÄ±nÄ±zÄ± YazÄ±n)</label>
      <input type="text" id="f-cat" placeholder="Ã–rn: Radikal Grup, AyrÄ±lÄ±kÃ§Ä± vb." oninput="syncData()">

      <label>Ä°Ã§erik EditÃ¶rÃ¼ (Yazar Modu)</label>
      <div class="tabs" style="margin-top:10px;">
        <button class="tab-btn active" onclick="showTab(0)">OluÅŸum</button>
        <button class="tab-btn" onclick="showTab(1)">Hedef</button>
        <button class="tab-btn" onclick="showTab(2)">YÃ¶netim</button>
        <button class="tab-btn" onclick="showTab(3)">Taktik</button>
        <button class="tab-btn" onclick="showTab(4)">Eylemler</button>
        <button class="tab-btn" onclick="showTab(5)">Kaynak</button>
        <button class="tab-btn" onclick="showTab(6)">Ä°liÅŸkiler</button>
        <button class="tab-btn" onclick="showTab(7)">DiÄŸer</button>
        <button class="tab-btn" onclick="showTab(8)">KaynakÃ§a</button>
      </div>

      <div id="tab-container">
        <div class="editor-toolbar">
          <button class="toolbar-btn" onclick="execCmd('bold')">B</button>
          <button class="toolbar-btn" onclick="execCmd('italic')"><i>I</i></button>
          <button class="toolbar-btn" onclick="execCmd('formatBlock', 'h3')">H3</button>
          <button class="toolbar-btn" onclick="execCmd('createLink', prompt('Link girin:'))">ðŸ”— Link</button>
          <button class="toolbar-btn" onclick="execCmd('unlink')">BaÄŸÄ± KaldÄ±r</button>
        </div>
        <div id="rich-editor" class="rich-editor" contenteditable="true" oninput="syncData()"></div>
      </div>

      <button class="btn btn-delete" onclick="deleteCurrentGroup()">BU Ã–RGÃœTÃœ SÄ°STEMDEN SÄ°L</button>
    </div>
  </div>
</div>

<script>
let mainData = {};
let selectedCountryId = null;
let selectedGroupIdx = null;
let activeTabIdx = 0;

// Sekme baÅŸlÄ±klarÄ±nÄ±n data anahtarlarÄ±
const tabKeys = [
  'olusum_sureci', 'nihai_hedef', 'yonetim_yapisi', 
  'eylem_metotlari', 'eylemler', 'finansman_kaynaklari', 
  'grup_iliskileri', 'diger_bilgiler', 'kaynakca'
];

// Rich Text KomutlarÄ±
function execCmd(cmd, val = null) {
  document.execCommand(cmd, false, val);
}

// Dosya YÃ¼kleme
document.getElementById('json-input').onchange = function(e) {
  const reader = new FileReader();
  reader.onload = function() {
    mainData = JSON.parse(reader.result);
    document.getElementById('overlay').style.display = 'none';
    initMap();
  };
  reader.readAsText(e.target.files[0]);
};

function initMap() {
  const layer = document.getElementById('map-layer');
  // Buraya projedeki tÃ¼m <path> verilerini eklemelisin. Ã–rnek olarak TR ve birkaÃ§Ä±:
  layer.innerHTML = `
    <path id="TR" d="M 610,210 L 690,210 L 690,250 L 610,250 Z" />
    <path id="SY" d="M 620,260 L 660,260 L 650,280 L 615,280 Z" />
    <path id="IQ" d="M 665,260 L 690,260 L 690,290 L 660,290 Z" />
  `; // Ã–NEMLÄ°: TÃ¼m dÃ¼nya pathlerini buraya yapÄ±stÄ±r.

  const paths = layer.querySelectorAll('path');
  paths.forEach(p => {
    p.onmouseenter = (e) => showTooltip(e, p.id);
    p.onmousemove = (e) => moveTooltip(e);
    p.onmouseleave = () => hideTooltip();
    p.onclick = () => selectCountry(p.id);
  });
}

function showTooltip(e, id) {
  const tip = document.getElementById('tooltip');
  const country = mainData[id];
  const count = (country && country.groups) ? country.groups.length : 0;
  const names = (country && country.groups) ? country.groups.map(g => g.name_tr).slice(0,3).join(", ") : "KayÄ±t yok";
  
  tip.innerHTML = `<strong>${id}</strong><br>Ã–rgÃ¼t SayÄ±sÄ±: ${count}<br><span style="font-size:11px; color:#666">${names}...</span>`;
  tip.style.display = 'block';
}

function moveTooltip(e) {
  const tip = document.getElementById('tooltip');
  tip.style.left = (e.pageX + 15) + 'px';
  tip.style.top = (e.pageY + 15) + 'px';
}

function hideTooltip() { document.getElementById('tooltip').style.display = 'none'; }

function selectCountry(id) {
  selectedCountryId = id;
  selectedGroupIdx = null;
  document.querySelectorAll('path').forEach(p => p.classList.remove('selected'));
  if(document.getElementById(id)) document.getElementById(id).classList.add('selected');

  document.getElementById('edit-country-name').innerText = id;
  document.getElementById('editor-panel').classList.add('open');
  document.getElementById('editor-fields').style.display = 'none';
  renderGroupPills();
}

function renderGroupPills() {
  const area = document.getElementById('group-list-area');
  area.innerHTML = "";
  if(mainData[selectedCountryId]?.groups) {
    mainData[selectedCountryId].groups.forEach((g, idx) => {
      const pill = document.createElement('div');
      pill.className = 'group-pill' + (selectedGroupIdx === idx ? ' active' : '');
      pill.innerText = g.name_tr || "AdsÄ±z Ã–rgÃ¼t";
      pill.onclick = () => loadGroupData(idx);
      area.appendChild(pill);
    });
  }
}

function loadGroupData(idx) {
  selectedGroupIdx = idx;
  renderGroupPills();
  const g = mainData[selectedCountryId].groups[idx];
  
  document.getElementById('editor-fields').style.display = 'block';
  document.getElementById('f-name').value = g.name_tr || "";
  document.getElementById('f-cat').value = g.kategori || "";
  
  // Mevcut sekmedeki veriyi yÃ¼kle
  updateRichEditorContent();
}

function updateRichEditorContent() {
  const g = mainData[selectedCountryId].groups[selectedGroupIdx];
  if(!g.details) g.details = {};
  const key = tabKeys[activeTabIdx];
  document.getElementById('rich-editor').innerHTML = g.details[key] || "";
}

function showTab(idx) {
  activeTabIdx = idx;
  document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
  updateRichEditorContent();
}

function syncData() {
  if(selectedCountryId === null || selectedGroupIdx === null) return;
  
  let g = mainData[selectedCountryId].groups[selectedGroupIdx];
  g.name_tr = document.getElementById('f-name').value;
  g.kategori = document.getElementById('f-cat').value;
  
  if(!g.details) g.details = {};
  const key = tabKeys[activeTabIdx];
  g.details[key] = document.getElementById('rich-editor').innerHTML;
  
  renderGroupPills();
}

function addNewGroup() {
  if(!mainData[selectedCountryId]) mainData[selectedCountryId] = { groups: [] };
  mainData[selectedCountryId].groups.push({ name_tr: "Yeni Ã–rgÃ¼t", kategori: "", details: {} });
  loadGroupData(mainData[selectedCountryId].groups.length - 1);
}

function deleteCurrentGroup() {
  if(confirm("DÄ°KKAT: Bu Ã¶rgÃ¼t verisi tamamen silinecek. OnaylÄ±yor musunuz?")) {
    mainData[selectedCountryId].groups.splice(selectedGroupIdx, 1);
    selectedGroupIdx = null;
    document.getElementById('editor-fields').style.display = 'none';
    renderGroupPills();
  }
}

function downloadJSON() {
  const dataStr = JSON.stringify(mainData, null, 2);
  const blob = new Blob([dataStr], {type: "application/json"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "militan_atlas_yeni.json";
  a.click();
}
</script>

</body>
</html>
