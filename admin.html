<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MÄ°LÄ°TAN ATLASI | EDÄ°TÃ–R</title>
  <style>
    /* â”€â”€â”€ GENEL TASARIM â”€â”€â”€ */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    h1, h2, h3 { color: #4ade80; margin-top: 0; margin-bottom: 10px; }
    
    .container {
      display: flex;
      flex: 1;
      gap: 20px;
      overflow: hidden;
      border: 1px solid #333;
      background: #1a1a1a;
      border-radius: 8px;
    }

    /* â”€â”€â”€ SOL PANEL (LÄ°STE & ARAMA) â”€â”€â”€ */
    .sidebar {
      width: 320px;
      background: #252525;
      padding: 15px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #333;
    }

    .search-box {
        margin-bottom: 15px;
    }
    
    .scrollable-list {
        flex: 1;
        overflow-y: auto;
        padding-right: 5px;
    }

    /* LÄ°STE ELEMANLARI */
    .list-item {
      padding: 12px;
      background: #333;
      margin-bottom: 6px;
      cursor: pointer;
      border-radius: 4px;
      border-left: 4px solid transparent;
      display: flex;
      flex-direction: column;
    }
    .list-item:hover { background: #444; }
    .list-item.active { 
        border-left-color: #4ade80; 
        background: #2a2a2a; 
        border-bottom: 1px solid #4ade80;
    }
    .item-name { font-weight: bold; color: #fff; }
    .item-sub { font-size: 11px; color: #888; margin-top: 2px; }

    /* â”€â”€â”€ SAÄ PANEL (EDÄ°TÃ–R) â”€â”€â”€ */
    .editor {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #1f1f1f;
    }

    /* FORM */
    label { display: block; margin-top: 15px; font-size: 13px; color: #4ade80; font-weight: bold; }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      background: #111;
      border: 1px solid #444;
      color: #fff;
      border-radius: 6px;
      font-family: inherit;
      box-sizing: border-box;
    }
    textarea { height: 100px; resize: vertical; line-height: 1.4; }
    input:focus, textarea:focus { border-color: #4ade80; outline: none; background: #000; }

    /* BUTONLAR */
    .btn {
      padding: 12px 20px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      transition: 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    .btn-primary { background: #4ade80; color: #000; }
    .btn-primary:hover { background: #3ecf72; box-shadow: 0 0 10px rgba(74,222,128,0.3); }
    
    .btn-danger { background: #ff4444; color: #fff; width: 100%; margin-top: 20px; }
    .btn-danger:hover { background: #cc3333; }

    .btn-add { background: #333; color: #ddd; width: 100%; margin-bottom: 10px; border: 1px dashed #666; }
    .btn-add:hover { background: #444; color: #fff; border-color: #fff; }

    /* Dosya YÃ¼kleme EkranÄ± */
    #start-screen {
        position: absolute; inset: 0; background: #111; z-index: 999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .upload-box {
      border: 2px dashed #444;
      padding: 40px;
      text-align: center;
      color: #888;
      cursor: pointer;
      border-radius: 12px;
      transition: 0.2s;
    }
    .upload-box:hover { border-color: #4ade80; color: #4ade80; background: rgba(74,222,128,0.05); }

    .hidden { display: none !important; }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #666; }
  </style>
</head>
<body>

  <div id="start-screen">
    <h1 style="font-size: 32px; margin-bottom: 40px;">MÄ°LÄ°TAN ATLASI | EDÄ°TÃ–R</h1>
    <div class="upload-box" onclick="document.getElementById('file-input').click()">
      <h3 style="font-size: 20px;">ğŸ“‚ trdata.json DosyasÄ±nÄ± SeÃ§</h3>
      <p>Proje klasÃ¶rÃ¼ndeki dosyayÄ± seÃ§ip dÃ¼zenlemeye baÅŸla.</p>
    </div>
    <input type="file" id="file-input" accept=".json" onchange="loadJSON(this)" style="display:none;">
    
    <div style="margin-top: 30px;">
        <button class="btn btn-add" style="width:auto; padding: 10px 30px;" onclick="createNewData()">SÄ±fÄ±rdan BaÅŸla</button>
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;" id="top-bar" class="hidden">
    <h2>YÃ–NETÄ°M PANELÄ°</h2>
    <div style="display:flex; gap:10px;">
        <button class="btn btn-primary" style="background:#333; color:#fff; border:1px solid #444;" onclick="document.getElementById('file-input').click()">ğŸ“‚ Dosya DeÄŸiÅŸtir</button>
        <button class="btn btn-primary" onclick="downloadJSON()">ğŸ’¾ KAYDET VE Ä°NDÄ°R</button>
    </div>
  </div>

  <div class="container hidden" id="editor-container">
    
    <div class="sidebar">
      <div class="search-box">
          <label style="margin-top:0; margin-bottom:5px; color:#aaa;">Filtrele / Ara</label>
          <input type="text" id="global-search" placeholder="Ã–rgÃ¼t adÄ± veya Ãœlke kodu..." oninput="filterGroups(this.value)" autocomplete="off">
      </div>
      
      <button class="btn btn-add" onclick="addNewGroupDialog()">+ YENÄ° Ã–RGÃœT EKLE</button>

      <div class="scrollable-list" id="group-list">
          </div>
    </div>

    <div class="editor">
      <div id="welcome-msg" style="text-align:center; color:#666; margin-top:150px;">
        <p style="font-size:18px;">Sol taraftan bir Ã¶rgÃ¼t seÃ§in veya arama yapÄ±n.</p>
        <p style="font-size:14px; color:#444;">DeÄŸiÅŸiklikler anlÄ±k olarak hafÄ±zaya alÄ±nÄ±r. Ã‡Ä±kmadan Ã¶nce "Kaydet" demeyi unutma.</p>
      </div>

      <div id="form-area" class="hidden">
        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:20px;">
            <h2 id="editor-title" style="margin:0;">Grup DÃ¼zenle</h2>
            <span id="editor-country-badge" style="background:#333; padding:5px 10px; border-radius:4px; font-size:12px; color:#aaa; align-self:center;">TR</span>
        </div>
        
        <label>Ã–rgÃ¼t AdÄ± (GÃ¶rÃ¼nen Ä°sim)</label>
        <input type="text" id="inp-name" oninput="updateCurrentGroup('name_tr', this.value)">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div>
                <label>Kategori</label>
                <select id="inp-cat" onchange="updateCurrentGroup('kategori', this.value)">
                    <option value="TerÃ¶r Ã–rgÃ¼tÃ¼">TerÃ¶r Ã–rgÃ¼tÃ¼</option>
                    <option value="Milis GÃ¼cÃ¼">Milis GÃ¼cÃ¼</option>
                    <option value="Ä°syancÄ± Grup">Ä°syancÄ± Grup</option>
                    <option value="Paramiliter">Paramiliter</option>
                    <option value="Bilinmiyor">Bilinmiyor</option>
                </select>
            </div>
            <div>
                <label>Durum</label>
                <input type="text" id="inp-status" placeholder="Ã–rn: Aktif, Pasif, DaÄŸÄ±ldÄ±..." oninput="updateCurrentDetail('grup_durumu', this.value)">
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
           <div>
              <label>OluÅŸumu ve GeliÅŸimi</label>
              <textarea oninput="updateCurrentDetail('olusum_sureci', this.value)" id="txt-olusum"></textarea>
           </div>
           <div>
              <label>AmaÃ§ ve Nihai Hedef</label>
              <textarea oninput="updateCurrentDetail('nihai_hedef', this.value)" id="txt-amac"></textarea>
           </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div>
               <label>YÃ¶netim ve YapÄ±lanma</label>
               <textarea oninput="updateCurrentDetail('yonetim_yapisi', this.value)" id="txt-yonetim"></textarea>
            </div>
            <div>
               <label>Eylem MetotlarÄ±</label>
               <textarea oninput="updateCurrentDetail('eylem_metotlari', this.value)" id="txt-metot"></textarea>
            </div>
         </div>

         <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div>
               <label>Ã–nemli Eylemler</label>
               <textarea oninput="updateCurrentDetail('onemli_eylemler', this.value)" id="txt-eylem"></textarea>
            </div>
            <div>
               <label>Finans KaynaklarÄ±</label>
               <textarea oninput="updateCurrentDetail('finansman_kaynaklari', this.value)" id="txt-finans"></textarea>
            </div>
         </div>

         <label>DiÄŸer Gruplarla Ä°liÅŸkiler</label>
         <textarea style="height:70px;" oninput="updateCurrentDetail('grup_iliskileri', this.value)" id="txt-iliski"></textarea>

         <label>KaynakÃ§a</label>
         <textarea style="height:70px;" oninput="updateCurrentDetail('kaynakca', this.value)" id="txt-kaynak"></textarea>

         <button class="btn btn-danger" onclick="deleteCurrentGroup()">ğŸ—‘ï¸ BU Ã–RGÃœTÃœ SÄ°L</button>

      </div>
    </div>
  </div>

<script>
    // â”€â”€â”€ VERÄ° YÃ–NETÄ°MÄ° â”€â”€â”€
    let mainData = {};
    let allGroupsFlat = []; // DÃ¼zleÅŸtirilmiÅŸ liste (Arama ve listeleme iÃ§in kolaylÄ±k)
    
    let currentEditId = null; // { countryCode: 'TR', index: 0 }

    // 1. JSON YÃœKLEME
    function loadJSON(input) {
        const file = input.files[0];
        if(!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                mainData = JSON.parse(e.target.result);
                startApp();
            } catch(err) {
                alert("Dosya bozuk veya hatalÄ± JSON formatÄ±nda.");
            }
        };
        reader.readAsText(file);
    }

    function createNewData() {
        if(confirm("BoÅŸ bir veri seti oluÅŸturulacak?")) {
            mainData = {};
            startApp();
        }
    }

    function startApp() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('top-bar').classList.remove('hidden');
        document.getElementById('editor-container').classList.remove('hidden');
        flattenData(); // Veriyi listeye Ã§evir
        renderList(""); // Listeyi Ã§iz
    }

    // 2. VERÄ°YÄ° DÃœZLEÅTÄ°R (Kolay Liste GÃ¶rÃ¼nÃ¼mÃ¼ Ä°Ã§in)
    function flattenData() {
        allGroupsFlat = [];
        Object.keys(mainData).forEach(countryCode => {
            const country = mainData[countryCode];
            if(country.groups && Array.isArray(country.groups)) {
                country.groups.forEach((grp, idx) => {
                    allGroupsFlat.push({
                        countryCode: countryCode,
                        countryName: country.name_tr || countryCode,
                        index: idx, // Array iÃ§indeki orijinal index
                        ...grp
                    });
                });
            }
        });
        // Ä°sme gÃ¶re sÄ±rala
        allGroupsFlat.sort((a,b) => (a.name_tr || "").localeCompare(b.name_tr || ""));
    }

    // 3. LÄ°STEYÄ° Ã‡Ä°Z (Filtreleme Destekli)
    function renderList(searchTerm) {
        const listEl = document.getElementById('group-list');
        listEl.innerHTML = "";
        
        const term = searchTerm.toLowerCase().trim();
        
        const filtered = allGroupsFlat.filter(item => {
            const n = (item.name_tr || "").toLowerCase();
            const c = (item.countryName || "").toLowerCase();
            const cc = (item.countryCode || "").toLowerCase();
            return n.includes(term) || c.includes(term) || cc.includes(term);
        });

        if(filtered.length === 0) {
            listEl.innerHTML = "<div style='padding:20px; text-align:center; color:#666;'>SonuÃ§ yok.</div>";
            return;
        }

        filtered.forEach(item => {
            const div = document.createElement("div");
            div.className = "list-item";
            
            // EÄŸer ÅŸu an dÃ¼zenlenen buysa aktif yap
            if(currentEditId && currentEditId.countryCode === item.countryCode && currentEditId.index === item.index) {
                div.classList.add("active");
            }

            div.innerHTML = `
                <span class="item-name">${item.name_tr || "Ä°simsiz Ã–rgÃ¼t"}</span>
                <span class="item-sub">${item.countryCode} - ${item.countryName} | ${item.kategori || "-"}</span>
            `;
            
            div.onclick = () => loadGroupToEditor(item.countryCode, item.index);
            listEl.appendChild(div);
        });
    }

    function filterGroups(val) {
        renderList(val);
    }

    // 4. EDÄ°TÃ–RE YÃœKLE
    function loadGroupToEditor(cCode, idx) {
        currentEditId = { countryCode: cCode, index: idx };
        
        // Listeyi yeniden Ã§iz (aktif class'Ä± gÃ¼ncellemek iÃ§in) ama aramayÄ± bozma
        const searchVal = document.getElementById('global-search').value;
        renderList(searchVal);

        const grp = mainData[cCode].groups[idx];
        const det = grp.details || {};

        document.getElementById('welcome-msg').classList.add('hidden');
        document.getElementById('form-area').classList.remove('hidden');

        document.getElementById('editor-title').textContent = grp.name_tr || "Ã–rgÃ¼t DÃ¼zenle";
        document.getElementById('editor-country-badge').textContent = cCode + " - " + (mainData[cCode].name_tr || "");

        // Formu Doldur
        document.getElementById('inp-name').value = grp.name_tr || "";
        // Kategori selectini ayarla (EÄŸer listede yoksa 'Bilinmiyor' yap veya ekle)
        const catSelect = document.getElementById('inp-cat');
        catSelect.value = grp.kategori || "Bilinmiyor";
        
        document.getElementById('inp-status').value = det.grup_durumu || "";
        
        document.getElementById('txt-olusum').value = det.olusum_sureci || "";
        document.getElementById('txt-amac').value = det.nihai_hedef || "";
        document.getElementById('txt-yonetim').value = det.yonetim_yapisi || "";
        document.getElementById('txt-metot').value = det.eylem_metotlari || "";
        document.getElementById('txt-eylem').value = det.onemli_eylemler || "";
        document.getElementById('txt-finans').value = det.finansman_kaynaklari || "";
        document.getElementById('txt-iliski').value = det.grup_iliskileri || "";
        document.getElementById('txt-kaynak').value = det.kaynakca || "";
    }

    // 5. CANLI GÃœNCELLEME
    function updateCurrentGroup(key, val) {
        if(!currentEditId) return;
        mainData[currentEditId.countryCode].groups[currentEditId.index][key] = val;
        
        if(key === 'name_tr') {
             // Ä°smi gÃ¼ncelleyince listeyi de gÃ¼ncelle ki solda gÃ¶rÃ¼nsÃ¼n
             flattenData();
             renderList(document.getElementById('global-search').value);
             document.getElementById('editor-title').textContent = val;
        }
    }

    function updateCurrentDetail(key, val) {
        if(!currentEditId) return;
        const grp = mainData[currentEditId.countryCode].groups[currentEditId.index];
        if(!grp.details) grp.details = {};
        grp.details[key] = val;
    }

    // 6. YENÄ° EKLEME VE SÄ°LME
    function addNewGroupDialog() {
        const code = prompt("Hangi Ãœlke Kodu Ä°Ã§in Eklenecek? (Ã–rn: TR, US, SY)");
        if(!code) return;
        
        const upperCode = code.toUpperCase();
        
        // EÄŸer Ã¼lke JSON'da yoksa oluÅŸturalÄ±m mÄ±?
        if(!mainData[upperCode]) {
            if(confirm("Bu Ã¼lke kodu ("+upperCode+") sistemde yok. Yeni Ã¼lke oluÅŸturulsun mu?")) {
                const cName = prompt("Ãœlke AdÄ± (Ã–rn: TÃ¼rkiye):");
                mainData[upperCode] = { name_tr: cName || upperCode, groups: [] };
            } else {
                return;
            }
        }

        if(!mainData[upperCode].groups) mainData[upperCode].groups = [];

        // BoÅŸ ÅŸablon
        const newGrp = {
            name_tr: "Yeni Ä°simsiz Ã–rgÃ¼t",
            kategori: "Bilinmiyor",
            details: {}
        };
        
        mainData[upperCode].groups.push(newGrp);
        const newIdx = mainData[upperCode].groups.length - 1;

        // Veriyi yenile ve aÃ§
        flattenData();
        loadGroupToEditor(upperCode, newIdx);
        
        // Arama kutusunu temizle ki yeni eklenen gÃ¶rÃ¼nsÃ¼n
        document.getElementById('global-search').value = "";
        renderList("");
        
        // Scroll'u o elemana gÃ¶tÃ¼r (Basit yÃ¶ntem: en alta in)
        const listEl = document.getElementById('group-list');
        listEl.scrollTop = listEl.scrollHeight;
    }

    function deleteCurrentGroup() {
        if(!currentEditId) return;
        if(confirm("Bu Ã¶rgÃ¼t kaydÄ±nÄ± kalÄ±cÄ± olarak silmek istediÄŸine emin misin?")) {
            mainData[currentEditId.countryCode].groups.splice(currentEditId.index, 1);
            
            // EditÃ¶rÃ¼ kapat
            currentEditId = null;
            document.getElementById('form-area').classList.add('hidden');
            document.getElementById('welcome-msg').classList.remove('hidden');
            
            flattenData();
            renderList(document.getElementById('global-search').value);
        }
    }

    // 7. Ä°NDÄ°RME
    function downloadJSON() {
        const dataStr = JSON.stringify(mainData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = "trdata.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>
