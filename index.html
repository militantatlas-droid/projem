<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MİLİTAN ATLASI AFRİKA PRO</title>
  <style>
    :root {
      --primary-green: #4ade80;
      --active-red: #ff4444;
      --bg-dark: #0a0a0a;
      --panel-bg: #141414;
      --text-main: #eee;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; overflow: hidden; }
    
    /* 1- HARİTA BEYAZ, ARKA PLAN KARANLIK */
    #container { position: relative; width: 100%; height: 100%; display: flex; }
    #map-area { flex: 1; background: #000; position: relative; overflow: hidden; transition: filter 0.3s; }
    svg { width: 100%; height: 100%; }
    
    svg path {
      fill: #ffffff; /* Harita Beyaz */
      stroke: #333;
      stroke-width: 1;
      transition: fill 0.2s, stroke 0.2s;
      vector-effect: non-scaling-stroke;
      cursor: pointer;
    }

    /* 2- HOVER YEŞİL, TIKLAYINCA KIRMIZI */
    svg path:hover { fill: var(--primary-green) !important; }
    svg path.selected-country { fill: var(--active-red) !important; stroke: #fff; stroke-width: 2; }
    
    /* 4- BUTONLARIN GÖRÜNÜRLÜĞÜ */
    .control-btn {
      background: var(--panel-bg);
      color: var(--primary-green);
      border: 1px solid var(--primary-green);
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      box-shadow: 0 4px 15px rgba(74, 222, 128, 0.2);
    }
    .control-btn:hover { background: var(--primary-green); color: #000; }

    #main-controls { position: absolute; bottom: 30px; right: 30px; display: flex; gap: 10px; z-index: 100; }
    
    /* 6- SADE TOOLTIP BOX VE ÖRGÜT ÖNİZLEME */
    #tooltip {
      position: fixed;
      background: rgba(0,0,0,0.9);
      padding: 12px;
      border-radius: 6px;
      border: 1px solid var(--primary-green);
      color: #fff;
      font-size: 13px;
      pointer-events: none;
      display: none;
      z-index: 1000;
      min-width: 150px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .tt-title { font-weight: bold; border-bottom: 1px solid #444; margin-bottom: 5px; padding-bottom: 3px; color: var(--primary-green); }
    .tt-group-tag { font-size: 11px; background: #333; padding: 2px 5px; border-radius: 3px; margin: 2px; display: inline-block; }

    /* SIDEBAR */
    #sidebar {
      position: fixed; right: 0; top: 0; bottom: 0; width: 350px;
      background: var(--panel-bg); border-left: 1px solid #333;
      z-index: 300; transform: translateX(100%); transition: 0.4s;
      display: flex; flex-direction: column;
    }
    #sidebar.active { transform: translateX(0); }
    .sidebar-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .list-area { padding: 20px; overflow-y: auto; flex: 1; }
    .group-item { 
      background: #1d1d1d; padding: 15px; border-radius: 6px; margin-bottom: 10px; 
      cursor: pointer; border: 1px solid #333; transition: 0.3s;
    }
    .group-item:hover { border-color: var(--primary-green); background: #252525; }

    /* 7- MODAL PENCERE (BLURLU) */
    #modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      display: none; justify-content: center; align-items: center; z-index: 2000;
    }
    #modal-box {
      background: #1a1a1a; width: 80%; max-width: 800px; height: 70vh;
      border-radius: 12px; border: 1px solid #444; display: flex; flex-direction: column;
      position: relative; overflow: hidden;
    }
    .modal-tabs { display: flex; background: #111; border-bottom: 1px solid #333; }
    .tab-btn { 
      padding: 15px 25px; border: none; background: none; color: #888; 
      cursor: pointer; font-weight: bold; font-size: 14px;
    }
    .tab-btn.active { color: var(--primary-green); border-bottom: 2px solid var(--primary-green); background: #1a1a1a; }
    .tab-content { flex: 1; padding: 30px; overflow-y: auto; display: none; }
    .tab-content.active { display: block; }
    
    .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .info-box { background: #222; padding: 15px; border-radius: 8px; }
    .info-label { font-size: 12px; color: #777; margin-bottom: 5px; text-transform: uppercase; }

    /* ADMIN PANEL BUTONU */
    #admin-add { position: absolute; bottom: 30px; left: 30px; width: 50px; height: 50px; border-radius: 50%; border: none; background: #222; color: #fff; font-size: 24px; cursor: pointer; border: 1px solid #444; z-index: 100; }
    #admin-add.active { background: var(--primary-green); color: #000; }

    .blur { filter: blur(8px); pointer-events: none; }
  </style>
</head>
<body>

<div id="container">
  <div id="map-area">
    <div id="tooltip"></div>
    <svg id="africa-map" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet">
      <path id="DZ" data-name="Cezayir" d="..." />
      </svg>
  </div>

  <button id="admin-add" title="Yeni Örgüt Ekle">+</button>

  <div id="main-controls">
    <button class="control-btn" id="btn-list-all">Tüm Örgütler</button>
  </div>

  <div id="sidebar">
    <div class="sidebar-header">
      <h2 id="side-title">Ülke Detayı</h2>
      <button onclick="closeSidebar()" style="background:none; border:none; color:#fff; cursor:pointer;">✕</button>
    </div>
    <div class="list-area" id="side-list"></div>
  </div>
</div>

<div id="modal-overlay">
  <div id="modal-box">
    <div class="modal-tabs">
      <button class="tab-btn active" data-tab="tab-temel">TEMEL</button>
      <button class="tab-btn" data-tab="tab-detay">DETAYLAR</button>
      <button class="tab-btn" data-tab="tab-eylem">EYLEMLER</button>
      <button class="tab-btn" data-tab="tab-finans">FİNANS</button>
      <button class="tab-btn" data-tab="tab-liderlik">LİDERLİK</button>
    </div>
    
    <div id="tab-temel" class="tab-content active">
      <div class="detail-grid" id="modal-basic-info">
        </div>
    </div>
    <div id="tab-detay" class="tab-content">
      <h3>Geniş Detay Analizi</h3>
      <p style="margin-top:15px; line-height:1.6; color:#ccc;" id="modal-detail-text"></p>
    </div>
    <div id="tab-eylem" class="tab-content"><h3>Eylem Geçmişi</h3><p>Veri bekleniyor...</p></div>
    <div id="tab-finans" class="tab-content"><h3>Finansal Kaynaklar</h3><p>Veri bekleniyor...</p></div>
    <div id="tab-liderlik" class="tab-content"><h3>Komuta Zinciri</h3><p>Veri bekleniyor...</p></div>

    <button onclick="closeModal()" style="position:absolute; top:10px; right:10px; background:none; border:none; color:#fff; cursor:pointer; font-size:20px;">✕</button>
  </div>
</div>

<script>
  // VERİ YAPISI (Örnek)
  let miltanData = {
    "DZ": [
      { id: 1, name: "AQIM", year: "2007", firstAction: "Algiers Bombing", status: "Aktif", detail: "Mağrip El-Kaidesi detaylı analizi..." },
      { id: 2, name: "Jund al-Khilafah", year: "2014", firstAction: "Kidnapping", status: "Pasif", detail: "IŞİD bağlantılı grup..." }
    ]
  };

  const svgMap = document.getElementById('africa-map');
  const tooltip = document.getElementById('tooltip');
  const sidebar = document.getElementById('sidebar');
  const modalOverlay = document.getElementById('modal-overlay');
  const mapArea = document.getElementById('map-area');
  const adminBtn = document.getElementById('admin-add');

  let selectedCountryId = null;
  let isAdminMode = false;

  // 1 & 2 - HARİTA TIKLAMA VE RENK YÖNETİMİ
  svgMap.addEventListener('click', (e) => {
    const path = e.target.closest('path');
    
    if (path) {
      e.stopPropagation();
      if(isAdminMode) {
        openAdminPanel(path.id, path.getAttribute('data-name'));
        return;
      }
      selectCountry(path.id);
    } else {
      // 3 - HARİTA DIŞINA TIKLANINCA SEÇİMİ KALDIR
      clearSelection();
    }
  });

  function selectCountry(id) {
    clearSelection();
    selectedCountryId = id;
    const path = document.getElementById(id);
    path.classList.add('selected-country');
    openSidebar(id, path.getAttribute('data-name'));
  }

  function clearSelection() {
    selectedCountryId = null;
    document.querySelectorAll('path').forEach(p => p.classList.remove('selected-country'));
    closeSidebar();
  }

  // 5 - ESC BASINCA İPTAL
  document.addEventListener('keydown', (e) => {
    if (e.key === "Escape") {
      clearSelection();
      closeModal();
    }
  });

  // 6 - TOOLTIP ÖRGÜT ÖNİZLEME
  svgMap.addEventListener('mousemove', (e) => {
    const path = e.target.closest('path');
    if (path) {
      const id = path.id;
      const name = path.getAttribute('data-name');
      const groups = miltanData[id] || [];
      
      let groupHtml = groups.map(g => `<span class="tt-group-tag">${g.name}</span>`).join('');
      if(groups.length === 0) groupHtml = '<div style="color:#666">Kayıt yok</div>';

      tooltip.style.display = 'block';
      tooltip.innerHTML = `<div class="tt-title">${name}</div>${groupHtml}`;
      tooltip.style.left = e.clientX + 15 + 'px';
      tooltip.style.top = e.clientY + 15 + 'px';
    } else {
      tooltip.style.display = 'none';
    }
  });

  svgMap.addEventListener('mouseleave', () => tooltip.style.display = 'none');

  // 7 - SIDEBAR VE MODAL PENCERELER
  function openSidebar(id, name) {
    const sideList = document.getElementById('side-list');
    document.getElementById('side-title').textContent = name;
    
    const groups = miltanData[id] || [];
    sideList.innerHTML = groups.map(g => `
      <div class="group-item" onclick="openGroupModal('${id}', ${g.id})">
        <strong>${g.name}</strong><br>
        <small>${g.status} | Kurul: ${g.year}</small>
      </div>
    `).join('');
    
    if(groups.length === 0) sideList.innerHTML = '<p>Bu ülkede kayıt bulunamadı.</p>';
    sidebar.classList.add('active');
  }

  function closeSidebar() { sidebar.classList.remove('active'); }

  function openGroupModal(countryId, groupId) {
    const group = miltanData[countryId].find(g => g.id === groupId);
    mapArea.classList.add('blur');
    modalOverlay.style.display = 'flex';

    document.getElementById('modal-basic-info').innerHTML = `
      <div class="info-box"><div class="info-label">ÖRGÜT ADI</div><b>${group.name}</b></div>
      <div class="info-box"><div class="info-label">KURULUŞ YILI</div><b>${group.year}</b></div>
      <div class="info-box"><div class="info-label">İLK BÜYÜK EYLEM</div><b>${group.firstAction}</b></div>
      <div class="info-box"><div class="info-label">DURUM</div><b style="color:${group.status === 'Aktif' ? '#4ade80':'#ff4444'}">${group.status}</b></div>
    `;
    document.getElementById('modal-detail-text').textContent = group.detail;
  }

  function closeModal() {
    mapArea.classList.remove('blur');
    modalOverlay.style.display = 'none';
  }

  // MODAL TAB SİSTEMİ
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn, .tab-content').forEach(el => el.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.tab).classList.add('active');
    });
  });

  // 8 - ADMIN PANEL (YENİ ÖRGÜT EKLEME)
  adminBtn.onclick = () => {
    isAdminMode = !isAdminMode;
    adminBtn.classList.toggle('active');
    alert(isAdminMode ? "Admin Modu Aktif: Örgüt eklemek istediğiniz ülkeye tıklayın." : "Admin Modu Kapalı.");
  };

  function openAdminPanel(id, name) {
    const orgName = prompt(`${name} için yeni örgüt adı:`);
    if(!orgName) return;
    const year = prompt("Kuruluş Yılı:");
    const status = prompt("Durum (Aktif/Pasif):");

    if(!miltanData[id]) miltanData[id] = [];
    miltanData[id].push({
      id: Date.now(),
      name: orgName,
      year: year,
      firstAction: "Belirtilmedi",
      status: status,
      detail: "Yeni eklenen örgüt açıklaması..."
    });
    
    alert("Örgüt eklendi! (Sayfa yenilenirse gider, kodun içindeki miltanData'ya kopyalayın)");
    isAdminMode = false;
    adminBtn.classList.remove('active');
    selectCountry(id);
  }

</script>
</body>
</html>
